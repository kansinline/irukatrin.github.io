<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Happy Birthday â€” ã„ãã‚‚ã®ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹</title>
<style>
  :root{
    --bg1:#FFF8EE;
    --bg2:#E8FFF7;
    --accent:#FF6B6B;
    --accent2:#6BCBFF;
    --card:#ffffff;
    --glass: rgba(255,255,255,0.75);
    --shadow: 0 8px 30px rgba(27,38,53,0.12);
    --font-sans: "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
  }
  html,body{height:100%;margin:0;font-family:var(--font-sans);background:linear-gradient(135deg,var(--bg1) 0%, var(--bg2) 100%);-webkit-font-smoothing:antialiased;}
  .wrap{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:32px;
    box-sizing:border-box;
  }

  .card{
    width:980px;
    max-width:96%;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.85));
    border-radius:18px;
    padding:28px;
    box-shadow:var(--shadow);
    position:relative;
    overflow:hidden;
  }

  /* å·¦ã®ã‚¤ãƒ©ã‚¹ãƒˆé ˜åŸŸ */
  .hero{
    display:flex;
    gap:20px;
    align-items:center;
  }
  .left{
    flex:0 0 360px;
    max-width:38%;
    min-width:220px;
    position:relative;
  }

  /* ã„ãã‚‚ã®ã‚¢ã‚¤ã‚³ãƒ³ç¾¤ï¼ˆSVGã§å¯æ„›ãï¼‰ */
  .creatures{
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:10px;
  }
  .creature{
    background:var(--glass);
    border-radius:12px;
    padding:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    transform-origin:center;
    animation:float 6s ease-in-out infinite;
  }
  .creature:nth-child(2){ animation-delay: -1s; }
  .creature:nth-child(3){ animation-delay: -2s; }
  .creature:nth-child(4){ animation-delay: -3s; }

  @keyframes float{
    0%{ transform: translateY(0px) }
    50%{ transform: translateY(-12px) rotate(-2deg) }
    100%{ transform: translateY(0px) }
  }

  svg{ width:74px; height:74px; display:block; }

  /* å³ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é ˜åŸŸ */
  .right{ flex:1; padding:10px 20px; min-width:220px; }
  h1{
    font-size:34px;
    margin:0 0 6px 0;
    letter-spacing:1px;
    color:#213547;
  }
  .subtitle{
    margin:0 0 18px 0;
    color:#556B7A;
  }
  .message{
    background:linear-gradient(180deg,#fff 0%, #fffefc 100%);
    border-radius:12px;
    padding:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.04);
    color:#213547;
    line-height:1.6;
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:14px;
    flex-wrap:wrap;
  }
  .btn{
    border:0;
    background:var(--accent);
    color:white;
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    box-shadow:0 6px 16px rgba(255,107,107,0.18);
  }
  .btn.secondary{
    background:transparent;
    border:2px solid rgba(33,53,71,0.06);
    color:#213547;
    box-shadow:none;
    font-weight:600;
  }

  /* ãƒãƒ«ãƒ¼ãƒ³ */
  .balloon{
    position:absolute;
    bottom:-40px;
    left:12%;
    width:160px;
    height:220px;
    pointer-events:none;
    opacity:0.95;
    transform-origin:center bottom;
    animation:rise 9s linear infinite;
  }
  .balloon:nth-child(2){ left:68%; width:120px; animation-duration:8s; animation-delay:-2s; }
  @keyframes rise{
    0%{ transform: translateY(0) rotate(0deg); opacity:0 }
    10%{ opacity:1 }
    50%{ transform: translateY(-420px) rotate(6deg) }
    100%{ transform: translateY(-800px) rotate(12deg); opacity:0 }
  }

  /* confetti canvas å…¨ç”»é¢ */
  #confettiCanvas{
    position:fixed;
    left:0; top:0; width:100%; height:100%;
    pointer-events:none;
    z-index:9999;
  }

  /* footer */
  .footer{
    margin-top:14px;
    font-size:13px;
    color:#6B7D8E;
    text-align:right;
  }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ï¼‰ */
  .modal{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background: rgba(12,18,28,0.35);
    z-index:10000;
  }
  .modal .box{
    width:92%;
    max-width:560px;
    background:white;
    border-radius:12px;
    padding:16px;
  }
  .modal textarea{
    width:100%;
    min-height:120px;
    border-radius:8px;
    border:1px solid #e6eef3;
    padding:10px;
    box-sizing:border-box;
    font-family:var(--font-sans);
  }

  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
  @media (max-width:720px){
    .hero{ flex-direction:column; align-items:center; }
    .left{ max-width:unset; width:100%; }
    .right{ width:100%; }
    h1{ font-size:28px; text-align:center; }
    .footer{text-align:center;}
  }
</style>
</head>
<body>
<canvas id="confettiCanvas" aria-hidden="true"></canvas>

<div class="wrap">
  <div class="card" role="main" aria-labelledby="title">
    <div class="hero">
      <div class="left" aria-hidden="false">
        <div class="creatures" aria-hidden="true">
          <!-- ã„ãã‚‚ã®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆå¥½ããªã‚‚ã®ã«å·®ã—æ›¿ãˆã¦OKï¼‰ -->
          <div class="creature" title="å°ã•ãªé­š">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <g fill="none" stroke="none">
                <ellipse cx="34" cy="32" rx="22" ry="14" fill="#6BCBFF"/>
                <circle cx="46" cy="24" r="3" fill="#fff"/>
                <path d="M8 18 C18 26, 18 38, 8 46" fill="#FFCE6B"/>
              </g>
            </svg>
          </div>
          <div class="creature" title="ã“ã¨ã‚Š">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <g fill="none" stroke="none">
                <circle cx="28" cy="28" r="12" fill="#FF6B6B"/>
                <path d="M36 34 L48 30 C52 28, 56 24, 56 20 C56 28, 48 40, 36 34 Z" fill="#FFD6A5"/>
              </g>
            </svg>
          </div>
          <div class="creature" title="ã‚«ãƒ¡">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <g fill="none" stroke="none">
                <ellipse cx="34" cy="34" rx="18" ry="12" fill="#8BE9A8"/>
                <circle cx="24" cy="30" r="3" fill="#2B2B2B"/>
              </g>
            </svg>
          </div>
          <div class="creature" title="ãŸã¬ã">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <g fill="none" stroke="none">
                <circle cx="32" cy="30" r="12" fill="#F7A3A3"/>
                <path d="M20 36 C26 44, 38 44, 44 36" fill="#fff"/>
              </g>
            </svg>
          </div>
        </div>

        <!-- æµ®éŠãƒãƒ«ãƒ¼ãƒ³ï¼ˆãƒ‡ã‚³ï¼‰ -->
        <svg class="balloon" viewBox="0 0 200 260" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#FFB6B9"/><stop offset="1" stop-color="#FF6B6B"/></linearGradient></defs>
          <ellipse cx="100" cy="80" rx="64" ry="86" fill="url(#g1)" opacity="0.95"/>
          <rect x="96" y="158" width="8" height="60" rx="4" fill="#B77C7C"/>
        </svg>
      </div>

      <div class="right">
        <h1 id="title">Happy Birthday â€” ã„ãã‚‚ã®ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹ ğŸ‰</h1>
        <p class="subtitle">ç´ æ•µãªä¸€æ—¥ã«ãªã‚Šã¾ã™ã‚ˆã†ã«ã€‚å¿ƒã‚’è¾¼ã‚ã¦ã€‚</p>

        <div class="message" id="mainMessage" aria-live="polite">
          <strong>ã„ãã‚‚ã®ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹ã•ã‚“ã€</strong><br>
          ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ä»Šæ—¥ã¯ã‚ãªãŸã®ç‰¹åˆ¥ãªæ—¥ â€” ãŸãã•ã‚“ç¬‘ã£ã¦ã€å¥½ããªã„ãã‚‚ã®ãŸã¡ã«å›²ã¾ã‚Œã¦ã€æœ€é«˜ã®æ™‚é–“ã‚’éã”ã—ã¦ã­ ğŸŸğŸ¦œğŸ¢ğŸ¦
        </div>

        <div class="controls" role="group" aria-label="controls">
          <button class="btn" id="playConfetti">ãŠç¥ã„ï¼(ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£)</button>
          <button class="btn secondary" id="editMessage">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†</button>
          <button class="btn secondary" id="toggleMusic">BGM ã‚’å†ç”Ÿ</button>
          <a class="btn secondary" id="downloadBtn" href="#" download="birthday_ikimono.html">ä¿å­˜ï¼ˆHTMLï¼‰</a>
        </div>

        <div class="footer">ä½œæˆè€…ï¼šã‚ãªãŸã®ã¨ã‚‚ã ã¡ã‚ˆã‚Š â€” ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè‡ªç”±</div>
      </div>
    </div>
  </div>
</div>

<!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†">
  <div class="box">
    <h3>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç·¨é›†</h3>
    <textarea id="messageInput"></textarea>
    <div style="text-align:right;margin-top:8px;">
      <button class="btn secondary" id="cancelModal">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn" id="saveModal">ä¿å­˜</button>
    </div>
  </div>
</div>

<!-- ç°¡æ˜“BGMï¼ˆãƒ•ãƒªãƒ¼æ›²ã®URLã«å·®ã—æ›¿ãˆå¯èƒ½ï¼‰ -->
<audio id="bgm" loop crossorigin="anonymous">
  <!-- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ç©ºã€‚ä½¿ã„ãŸã„MP3ã®URLã‚’ä¸‹è¨˜ã®data-musicå±æ€§ã«å…¥ã‚Œã¦ãŠãã¨åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ -->
</audio>

<script>
/* ========== ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã‚„ã™ã„ç®‡æ‰€ ==========
  ãƒšãƒ¼ã‚¸å†…ã® "ã„ãã‚‚ã®ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹" ã‚’åˆ¥ã®åå‰ã«å¤‰ãˆã‚‹ã«ã¯ã€HTMLå†…ã®ã‚¿ã‚¤ãƒˆãƒ«ç®‡æ‰€ã¨
  mainMessage ã®ä¸­èº«ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚
  BGMã‚’å…¥ã‚Œã‚‹å ´åˆã¯ã€ä¸‹ã® dataMusic ã«MP3ã®URLã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‹ã€
  ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç½®ã„ã¦ <audio> ã«ç›´æ¥æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
============================================ */

const nameDisplay = "ã„ãã‚‚ã®ãƒ‘ãƒ©ãƒ€ã‚¤ã‚¹"; // å¿…è¦ãªã‚‰ã“ã“ã‚’å¤‰ãˆã¦ãã ã•ã„
document.title = `Happy Birthday â€” ${nameDisplay}`;

/* ----- ã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ï¼ˆç°¡æ˜“ï¼‰ ----- */
const canvas = document.getElementById('confettiCanvas');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
let pieces = [];
const colors = ["#FF6B6B","#FFD166","#6BCBFF","#8BE9A8","#C39BFF","#FF9CE6"];

function rand(min,max){ return Math.random()*(max-min)+min; }
function makePiece(x,y){
  return {
    x:x, y:y,
    vx: rand(-2,2),
    vy: rand(-6,-2),
    r: rand(6,12),
    color: colors[Math.floor(rand(0,colors.length))],
    rot: rand(0,Math.PI*2),
    vr: rand(-0.08,0.08),
    life: 0,
    ttl: rand(80,140)
  };
}
function spawnConfetti(count){
  for(let i=0;i<count;i++){
    pieces.push(makePiece(rand(W*0.2,W*0.8), H*0.75));
  }
  if(pieces.length>120) pieces = pieces.slice(pieces.length-120);
}
function update(){
  ctx.clearRect(0,0,W,H);
  for(let i=pieces.length-1;i>=0;i--){
    const p = pieces[i];
    p.vy += 0.12; // gravity
    p.x += p.vx;
    p.y += p.vy;
    p.rot += p.vr;
    p.life++;
    const fade = 1 - (p.life / p.ttl);
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.rot);
    ctx.globalAlpha = Math.max(0, fade);
    ctx.fillStyle = p.color;
    ctx.fillRect(-p.r/2, -p.r/2, p.r, p.r * 0.6);
    ctx.restore();
    if(p.y > H + 40 || p.life > p.ttl){
      pieces.splice(i,1);
    }
  }
  requestAnimationFrame(update);
}
update();

/* ãƒœã‚¿ãƒ³ã§ç™ºå°„ */
document.getElementById('playConfetti').addEventListener('click', ()=>{
  spawnConfetti(60);
  // ã¡ã‚‡ã£ã¨é€£ç¶šã§å¢—ã‚„ã—ã¦æ¥½ã—ã
  setTimeout(()=>spawnConfetti(40), 250);
  setTimeout(()=>spawnConfetti(30), 500);
});

/* ç”»é¢ã‚µã‚¤ã‚ºå¯¾å¿œ */
addEventListener('resize', ()=>{
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
});

/* ========== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« ========== */
const modal = document.getElementById('modal');
const editBtn = document.getElementById('editMessage');
const cancelModal = document.getElementById('cancelModal');
const saveModal = document.getElementById('saveModal');
const messageInput = document.getElementById('messageInput');
const mainMessage = document.getElementById('mainMessage');

editBtn.addEventListener('click', ()=>{
  messageInput.value = mainMessage.innerHTML.replace(/<br>/g,"\n");
  modal.style.display = 'flex';
  messageInput.focus();
});
cancelModal.addEventListener('click', ()=> modal.style.display='none');
saveModal.addEventListener('click', ()=>{
  let val = messageInput.value.replace(/\n/g,"<br>");
  if(!val.trim()) val = `<strong>${nameDisplay}ã•ã‚“ã€</strong><br>ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ï¼`;
  mainMessage.innerHTML = val;
  modal.style.display = 'none';
});

/* ESCã§é–‰ã˜ã‚‹ */
addEventListener('keydown', (e)=>{
  if(e.key==='Escape') modal.style.display='none';
});

/* ========== BGM åˆ¶å¾¡ï¼ˆç©ºã®å ´åˆã¯å¤–éƒ¨URLã‚’ã‚»ãƒƒãƒˆã—ã¦ä½¿ã£ã¦ãã ã•ã„ï¼‰ ========== */
const bgm = document.getElementById('bgm');
const toggleMusic = document.getElementById('toggleMusic');

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§BGMã‚’æŒ‡å®šã—ãŸã„å ´åˆã¯ã“ã“ã«URLã‚’å…¥ã‚Œã¦ãã ã•ã„ï¼ˆä¾‹: "https://example.com/music.mp3"ï¼‰
const dataMusic = ""; // ã“ã“ã«mp3ã®URLã‚’å…¥ã‚Œã‚‹ã¨ãƒœã‚¿ãƒ³ã§å†ç”Ÿã§ãã¾ã™

if(dataMusic){
  bgm.src = dataMusic;
  toggleMusic.style.display = 'inline-block';
} else {
  // BGMãŒãªã„å ´åˆã€è¡¨ç¤ºã¯ã™ã‚‹ã‘ã©æŠ¼ã™ã¨éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹
  toggleMusic.textContent = "BGM ã‚’é¸æŠï¼ˆä»»æ„ï¼‰";
}
toggleMusic.addEventListener('click', async ()=>{
  if(!bgm.src){
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã•ã›ã‚‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§è¨±å¯ãŒã‚ã‚Œã°ï¼‰
    const input = document.createElement('input');
    input.type='file';
    input.accept='audio/*';
    input.onchange = () => {
      const f = input.files[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      bgm.src = url;
      bgm.play();
      toggleMusic.textContent = "BGM åœæ­¢";
    };
    input.click();
    return;
  }
  if(bgm.paused){
    try{
      await bgm.play();
      toggleMusic.textContent = "BGM åœæ­¢";
    }catch(e){
      alert("è‡ªå‹•å†ç”Ÿã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§åˆ¶é™ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã‚’ã‚‚ã†ä¸€åº¦æŠ¼ã—ã¦ãã ã•ã„ã€‚");
    }
  }else{
    bgm.pause();
    toggleMusic.textContent = "BGM ã‚’å†ç”Ÿ";
  }
});

/* ========== ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ï¼ˆHTMLä¿å­˜ã®ç°¡æ˜“å‡¦ç†ï¼‰ ========== */
const downloadBtn = document.getElementById('downloadBtn');
downloadBtn.addEventListener('click', (e)=>{
  // ç¾åœ¨ã®DOMã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‹ï¼ˆã‚¹ã‚¿ã‚¤ãƒ«ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§åŸ‹ã‚ã¦ãªã„ãŒã€å…ƒã®HTMLãã®ã¾ã¾ä¿å­˜ï¼‰
  const doc = '<!doctype html>\n' + document.documentElement.outerHTML;
  const blob = new Blob([doc], {type: 'text/html'});
  const url = URL.createObjectURL(blob);
  downloadBtn.href = url;
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¯ãƒªãƒ³ã‚¯ã® href ã‚’æ›´æ–°ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«ä»»ã›ã‚‹
});

/* å°ã•ãªã‚¢ã‚¯ã‚»ãƒ³ãƒˆï¼šãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è»½ãã‚³ãƒ³ãƒ•ã‚§ãƒƒãƒ†ã‚£ */
window.addEventListener('load', ()=> spawnConfetti(36) );
</script>
</body>
</html>
