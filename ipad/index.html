<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iruka Railway Dashboard</title>
<link rel="icon" href="https://irukatrin.dolphin.f5.si/favicon.ico">
<style>
body {margin:0;padding:0;font-family:"Noto Sans JP",system-ui,sans-serif;background:#0d1117;color:#fff;overflow-x:hidden;}
header{display:flex;align-items:center;justify-content:center;padding:20px;}
.logo{height:48px;margin-right:16px;}
.site-name{font-size:2em;font-weight:bold;}
main{max-width:1200px;margin:20px auto;padding:0 16px;display:flex;flex-direction:column;gap:20px;}
.widget{background:rgba(20,20,30,0.9);border-radius:20px;padding:20px;box-shadow:0 10px 25px rgba(0,0,0,0.5);display:flex;flex-direction:column;align-items:center;justify-content:flex-start;transition:transform 0.2s;}
.widget:hover{transform:scale(1.02);}
.status-box{font-size:2.5em;font-weight:bold;padding:40px;border-radius:20px;width:100%;text-align:center;color:white;transition:background 0.3s;}
button{padding:18px 30px;border:none;border-radius:20px;background:linear-gradient(135deg,#1e88e5,#26c6da);color:#fff;cursor:pointer;font-weight:700;font-size:1.3em;margin-top:20px;transition:transform 0.2s;}
button:hover{transform:scale(1.05);}
.carousel-container{position:relative;width:100%;overflow:hidden;height:250px;border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.5);}
.carousel-track{display:flex;transition:transform 0.5s ease;}
.carousel-item{min-width:100%;flex-shrink:0;background:#1a1a2e;color:#fff;display:flex;align-items:center;justify-content:center;gap:15px;padding:20px;box-sizing:border-box;}
.carousel-item img{width:120px;height:80px;object-fit:cover;border-radius:12px;}
.carousel-item .news-content{flex:1;display:flex;flex-direction:column;}
.carousel-item h3{color:#1e88e5;margin-bottom:5px;font-size:1.2em;}
.carousel-item p{color:#ccc;margin-bottom:5px;font-size:0.9em;}
.carousel-item a{color:#26c6da;text-decoration:none;}
.carousel-item a:hover{text-decoration:underline;}
@media(max-width:768px){.carousel-item img{width:100px;height:70px;}}
</style>
</head>
<body>

<header>
  <img src="https://irukatrin.dolphin.f5.si/favicon.ico" class="logo">
  <span class="site-name">Iruka Railway</span>
</header>

<main>
  <div class="widget">
    <div id="api-status" class="status-box" style="background:red;">API停止中</div>
    <div id="start-container"></div>
  </div>

  <div class="widget">
    <h2>最新ニュース</h2>
    <div class="carousel-container">
      <div class="carousel-track" id="news-carousel"></div>
    </div>
  </div>
</main>

<script>
const API_CHECK_URL = "https://irukarailwayapi.onrender.com/trains";
const API_START_URL = "https://your-server-url.com/api/start";
const RSS_URL = "https://news.web.nhk/n-data/conf/na/rss/cat0.xml";
const CORS_PROXY = "https://api.allorigins.win/get?url=";

const texts = { ja:{running:"API起動中",stopped:"API停止中",starting:"API起動中…",startBtn:"APIを起動する",newsLoading:"ニュース取得中…",newsFail:"ニュース取得に失敗しました"} };
let lang="ja";

async function checkAPI(){
  const statusEl = document.getElementById('api-status');
  const startContainer = document.getElementById('start-container');
  startContainer.innerHTML="";
  statusEl.textContent="確認中…";
  statusEl.style.background="orange";
  try{
    const res = await fetch(API_CHECK_URL,{method:"HEAD"});
    if(res.ok){statusEl.textContent=texts[lang].running;statusEl.style.background="green";}
    else throw new Error();
  }catch{
    statusEl.textContent=texts[lang].stopped;statusEl.style.background="red";
    const btn=document.createElement('button'); btn.textContent=texts[lang].startBtn; btn.onclick=startAPI; startContainer.appendChild(btn);
  }
}

async function startAPI(){
  const statusEl=document.getElementById('api-status');
  const startContainer=document.getElementById('start-container');
  startContainer.innerHTML=""; statusEl.textContent="API起動中…"; statusEl.style.background="orange";
  try{ const res=await fetch(API_START_URL,{method:"POST"}); if(res.ok){statusEl.textContent=texts[lang].running;statusEl.style.background="green";} else throw new Error();}
  catch{statusEl.textContent=texts[lang].stopped;statusEl.style.background="red"; const btn=document.createElement('button'); btn.textContent=texts[lang].startBtn; btn.onclick=startAPI; startContainer.appendChild(btn);}
}

// RSS取得してカルーセル作成
async function fetchRSS(){
  const track = document.getElementById('news-carousel');
  track.innerHTML = `<div style="color:#ccc;padding:10px;">${texts[lang].newsLoading}</div>`;
  try{
    const res = await fetch(CORS_PROXY + encodeURIComponent(RSS_URL));
    const data = await res.json();
    const parser = new DOMParser();
    const xml = parser.parseFromString(data.contents,"application/xml");
    const items = xml.querySelectorAll("item");
    track.innerHTML="";
    items.forEach(item=>{
      const title=item.querySelector("title")?.textContent||"無題";
      const date=item.querySelector("pubDate")?.textContent||"";
      const link=item.querySelector("link")?.textContent||"#";
      const imgURL = item.querySelector("media\\:thumbnail")?.getAttribute("url") || item.querySelector("enclosure")?.getAttribute("url") || "https://via.placeholder.com/120x80?text=No+Image";
      const div=document.createElement('div'); div.className="carousel-item";
      div.innerHTML=`<img src="${imgURL}"><div class="news-content"><h3>${title}</h3><p>${date}</p><a href="${link}" target="_blank">詳細</a></div>`;
      track.appendChild(div);
    });
  }catch{track.innerHTML=`<div style="color:red;padding:10px;">${texts[lang].newsFail}</div>`;}
}

// 自動スクロール
let currentIndex=0;
function autoScroll(){
  const track=document.getElementById('news-carousel');
  const items=track.children;
  if(items.length===0) return;
  currentIndex=(currentIndex+1)%items.length;
  track.style.transform=`translateX(-${currentIndex*100}%)`;
}
setInterval(autoScroll,5000);

setInterval(checkAPI,10000);
setInterval(fetchRSS,300000);

window.addEventListener('load',()=>{checkAPI(); fetchRSS();});
</script>

</body>
</html>