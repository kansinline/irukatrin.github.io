<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Iruka Railway iPad API表示</title>
<link rel="icon" href="https://irukatrin.dolphin.f5.si/favicon.ico">
<style>
:root {
  --main: #1e88e5;
  --sub: #26c6da;
  --bg: #f0f4f8;
  --text: #333;
  --card-bg: rgba(255,255,255,0.95);
  --shadow: rgba(0,0,0,0.15);
}
* { box-sizing: border-box; margin:0; padding:0; font-family:"Noto Sans JP",system-ui,sans-serif; }
body { background: var(--bg); color: var(--text); overflow-x:hidden; }

header {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 16px; background:#fff; border-bottom:1px solid #ddd;
}
.logo { height:36px; }
.site-name { font-size:20px; font-weight:bold; }
.lang-select select { font-size:14px; padding:4px 6px; }

main { max-width:900px; margin:20px auto; padding:0 16px; }
.card { background: var(--card-bg); border-radius:20px; padding:20px; margin-bottom:16px;
        box-shadow:0 10px 25px var(--shadow); }
h2 { font-size:1.4em; color: var(--main); margin-bottom:12px; }
.status { text-align:center; margin:12px 0; font-size:1em; }
button { padding:12px 20px; border:none; border-radius:12px; background: var(--main); color:#fff; cursor:pointer; font-weight:600; font-size:1em; }

@media (max-width:1024px){
  main { margin:15px; }
  h2 { font-size:1.2em; }
}
@media (max-width:768px){
  header { flex-direction: column; align-items: flex-start; gap:10px; }
  .site-name { font-size:18px; }
  main { margin:10px; }
}
</style>
</head>
<body>

<header>
  <img src="https://irukatrin.dolphin.f5.si/favicon.ico" class="logo">
  <span class="site-name">Iruka Railway</span>
  <div class="lang-select">
    <select id="lang-select" onchange="setLanguage(this.value)">
      <option value="ja">日本語</option>
      <option value="en">English</option>
      <option value="zh">中文</option>
    </select>
  </div>
</header>

<main>
  <div class="status" id="status">読み込み中…</div>
  <div id="train-list"></div>
  <div id="start-container" style="text-align:center; margin-top:20px;"></div>
</main>

<script>
// 多言語テキスト
const texts = {
  ja: { loading:"データ取得中…", error:"データの取得に失敗しました。", noData:"データがありません", startBtn:"APIを起動する", starting:"API起動中…", running:"APIは起動中です" },
  en: { loading:"Fetching data…", error:"Failed to fetch data.", noData:"No data available", startBtn:"Start API", starting:"Starting API…", running:"API is running" },
  zh: { loading:"数据获取中…", error:"数据获取失败。", noData:"没有数据", startBtn:"启动API", starting:"API启动中…", running:"API已启动" }
};

let lang = "ja";
function setLanguage(l){
  lang = l;
  document.getElementById('status').textContent = texts[lang].loading;
}

// APIチェック
async function checkAPI(){
  const statusEl = document.getElementById('status');
  const startContainer = document.getElementById('start-container');
  statusEl.textContent = texts[lang].loading;
  statusEl.style.color = "blue";
  startContainer.innerHTML = "";
  try{
    const res = await fetch("https://irukarailwayapi.onrender.com/trains");
    if(res.ok){
      statusEl.textContent = texts[lang].running;
      statusEl.style.color = "green";
      fetchTrainData(); // 動作中ならデータ取得
    } else {
      throw new Error();
    }
  } catch(e){
    statusEl.textContent = texts[lang].error;
    statusEl.style.color = "red";
    // 起動ボタンを表示
    const btn = document.createElement('button');
    btn.textContent = texts[lang].startBtn;
    btn.onclick = startAPI;
    startContainer.appendChild(btn);
  }
}

// API起動
async function startAPI(){
  const startContainer = document.getElementById('start-container');
  const statusEl = document.getElementById('status');
  startContainer.innerHTML = "";
  statusEl.textContent = texts[lang].starting;
  statusEl.style.color = "orange";
  try{
    // Renderなどの起動用エンドポイント例
    const res = await fetch("https://irukarailwayapi.onrender.com/api/start", {method:"POST"});
    if(res.ok){
      statusEl.textContent = texts[lang].running;
      statusEl.style.color = "green";
      fetchTrainData();
    } else {
      throw new Error();
    }
  } catch(e){
    console.error(e);
    statusEl.textContent = texts[lang].error;
    statusEl.style.color = "red";
    // 再表示ボタン
    const btn = document.createElement('button');
    btn.textContent = texts[lang].startBtn;
    btn.onclick = startAPI;
    startContainer.appendChild(btn);
  }
}

// データ取得・表示
async function fetchTrainData(){
  const statusEl = document.getElementById('status');
  const listEl = document.getElementById('train-list');
  statusEl.textContent = texts[lang].loading;
  statusEl.style.color = "blue";
  listEl.innerHTML = "";

  try{
    const res = await fetch("https://irukarailwayapi.onrender.com/trains");
    if(!res.ok) throw new Error();
    const data = await res.json();
    if(!Array.isArray(data) || data.length===0){
      statusEl.textContent = texts[lang].noData;
      statusEl.style.color = "red";
      return;
    }
    statusEl.textContent = "";
    data.forEach(item=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h2>${item.line || "不明路線"}</h2>
        <p>運行状況: ${item.status || "-"}</p>
        <p>遅延: ${item.delay || "なし"}</p>
        <p>更新時刻: ${item.updated || "-"}</p>
      `;
      listEl.appendChild(card);
    });
  } catch(e){
    console.error(e);
    statusEl.textContent = texts[lang].error;
    statusEl.style.color = "red";
  }
}

// 初回ロード
window.addEventListener('load', ()=>{
  checkAPI();
});
</script>

</body>
</html>